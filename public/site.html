async function sendMessage() {
    const inputElement = document.getElementById("message");
    const message = inputElement.value;
    const characterId = "1";

    if (!message.trim()) return;

    const messagesDiv = document.getElementById("messages");
    const userTime = formatTime(new Date());

    // Add user message
    const userMessageContainer = document.createElement("div");
    userMessageContainer.className = "message-container user";

    const userMessage = document.createElement("div");
    userMessage.className = "user-message";
    userMessage.innerText = message;

    const userTimestamp = document.createElement("small");
    userTimestamp.className = "timestamp";
    userTimestamp.innerText = userTime;

    userMessageContainer.appendChild(userMessage);
    userMessageContainer.appendChild(userTimestamp);
    messagesDiv.appendChild(userMessageContainer);

    inputElement.value = "";
    messagesDiv.scrollTop = messagesDiv.scrollHeight;

    const botMessageContainer = document.createElement("div");
    botMessageContainer.className = "message-container bot";

    // Add typing indicator
    const typingIndicator = document.createElement("div");
    typingIndicator.className = "message-container bot typing-indicator";
    typingIndicator.innerHTML = `
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
    `;
    messagesDiv.appendChild(typingIndicator);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;

    try {
        const response = await fetch("https://carrd-chatbot.vercel.app/api/reply", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message, characterId }),
        });

        const data = await response.json();

        typingIndicator.remove();

        const botMessage = document.createElement("div");
        botMessage.className = "bot-message";
        botMessage.innerText = data.reply || "Error: " + data.error;

        const botTimestamp = document.createElement("small");
        botTimestamp.className = "timestamp";
        botTimestamp.innerText = formatTime(new Date());

        botMessageContainer.appendChild(botMessage);
        botMessageContainer.appendChild(botTimestamp);

        // Append the botMessageContainer to messagesDiv
        messagesDiv.appendChild(botMessageContainer);

        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    } catch (error) {
        typingIndicator.remove();

        const botMessage = document.createElement("div");
        botMessage.className = "bot-message";
        botMessage.innerText = "Error: Unable to connect to the server.";

        const botTimestamp = document.createElement("small");
        botTimestamp.className = "timestamp";
        botTimestamp.innerText = formatTime(new Date());

        botMessageContainer.appendChild(botMessage);
        botMessageContainer.appendChild(botTimestamp);

        // Append the botMessageContainer to messagesDiv
        messagesDiv.appendChild(botMessageContainer);

        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
}
