document.getElementById("chatForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const inputElement = document.getElementById("message");
    const message = inputElement.value;

    if (!message.trim()) return;

    const messagesDiv = document.getElementById("messages");

    // Add user message
    const userMessageContainer = document.createElement("div");
    userMessageContainer.className = "message-container user";

    const userMessage = document.createElement("div");
    userMessage.className = "user-message";
    userMessage.innerText = message;

    userMessageContainer.appendChild(userMessage);
    messagesDiv.appendChild(userMessageContainer);

    inputElement.value = "";

    messagesDiv.scrollTop = messagesDiv.scrollHeight;

    try {
        const response = await fetch("https://carrd-chatbot.vercel.app/api/reply", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message }),
        });

        const data = await response.json();

        const botMessageContainer = document.createElement("div");
        botMessageContainer.className = "message-container bot";

        const botMessage = document.createElement("div");
        botMessage.className = "bot-message";
        botMessage.innerHTML = data.reply || "Error: No response available.";

        botMessageContainer.appendChild(botMessage);
        messagesDiv.appendChild(botMessageContainer);

        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    } catch (error) {
        const botMessageContainer = document.createElement("div");
        botMessageContainer.className = "message-container bot";

        const botMessage = document.createElement("div");
        botMessage.className = "bot-message";
        botMessage.innerText = "Error: Unable to connect to the server.";

        botMessageContainer.appendChild(botMessage);
        messagesDiv.appendChild(botMessageContainer);

        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
});
