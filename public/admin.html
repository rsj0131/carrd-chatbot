<script>
    async function checkSession(initial = false) {
        // Detect if the user came from app.html and skip authentication
        const urlParams = new URLSearchParams(window.location.search);
        const bypassAuth = urlParams.has('bypassAuth'); // Check for a "bypassAuth" query parameter

        if (bypassAuth) {
            console.log("Bypassing authentication for admin.html access.");
            // Set default user details
            username = process.env.ADMIN_USERNAME;
            user_name = process.env.ADMIN_NAME;
            userID = process.env.ADMIN_ID;

            // Display username on the front-end
            document.getElementById("twitter-name").textContent = user_name || "";
            return;
        }

        try {
            const response = await fetch("/api/auth/check", { credentials: "include" });
            const data = await response.json();

            if (!data.logged_in) {
                if (!initial) {
                    alert("Session expired. Please log in again.");
                    window.location.href = "/auth.html?expired=true";
                } else {
                    window.location.href = "/auth.html";
                }
            } else {
                username = data.username;
                user_name = data.name;
                userID = data.id;
                document.getElementById("twitter-name").textContent = user_name || "";
            }
        } catch (error) {
            console.error("Error checking session:", error);
            alert("An error occurred. Please log in again.");
            window.location.href = "/auth.html";
        }
    }

    // Initial check when the page loads
    checkSession(true);

    async function loadUserInfo() {
        // This logic is already handled in checkSession
    }
</script>
